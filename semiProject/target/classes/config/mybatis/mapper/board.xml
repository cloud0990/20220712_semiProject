<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	
	<!-- 게시글 전체조회 -->
	<select id="board_list" resultType="vo.BoardVo">
		select * from board order by b_ref desc, b_step
	</select>
	<!-- b_idx에 해당하는 게시물 1건 조회 -->
	<select id="board_one" parameterType="int" resultType="vo.BoardVo">
		select * from board where b_idx=#{b_idx}
	</select>
	
	<!-- 게시글 작성 -->
	<insert id="board_insert" parameterType="vo.BoardVo">
		insert into board values(	seq_board_b_idx.nextVal, 
								 	#{b_subject}, #{b_content}, sysdate, #{b_ip}, default, default, 
								 	#{u_idx}, #{u_nickname}, seq_board_b_idx.currVal, 0, 0 
						        )
	</insert>
	
	<!-- 조회수 증가 -->
	<update id="board_update_readhit" parameterType="int">
		update board set b_readhit = b_readhit+1  where b_idx=#{b_idx}
	</update>
	
	<!-- 게시글 삭제 -->
	<update id="board_delete" parameterType="int">
		update board set 
						 b_subject='삭제된 게시글입니다.',
						 b_content='삭제된 게시글입니다.',
						 b_use_yn='n'
					 where b_idx=#{b_idx}
	</update>	
		
	<!-- 답글쓰기 : 같은그룹(b_ref) 내에서, b_step이 큰 게시물은 + 1 -->	
	<update id="board_update_step" parameterType="vo.BoardVo">
		update board set b_step=b_step+1 where b_ref=#{b_ref} and b_idx > #{b_idx}
	</update>	
		
	<!-- 답글쓰기 -->	
	<insert id="board_reply" parameterType="vo.BoardVo">
		insert into board values( seq_board_b_idx.nextVal,
								  #{b_subject}, #{b_content}, sysdate, #{b_ip}, default, default, 
								  #{u_idx}, #{u_nickname}, #{b_ref}, #{b_step}, #{b_depth} 
						        )
	</insert>	
	
	<!-- 게시글 수정 -->	
	<update id="board_update" parameterType="vo.BoardVo">
		update board set b_subject=#{b_subject}, b_content=#{b_content} where b_idx=#{b_idx} 
	</update>	
		
		
		
		
		
		
		
</mapper>